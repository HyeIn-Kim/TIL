# 13장 스코프 Scope

## 13.1 스코프란?

- 모든 식별자(변수 이름, 함수 이름, 클래스 이름...)는 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다. = **식별자가 유효한 범위**
- 식별자를 검색할 때 사용하는 규칙
  - 식별자 결정identifier resolution: 이름이 같은 두 개의 변수 중에서 어떤 변수를 참조해야 할 것인지 결정하는 것. 이 때 스코프가 활용된다.
- `var` 키워드로 선언한 변수와 `let`, `const` 키워드로 선언한 변수의 스코프가 다르다.
  - `var` 키워드로 선언된 변수는 같은 스코프 내에서 중복 선언이 허용된다. _의도치 않게 변수값이 재할당되어 변경되는 부작용이 발생할 수 있다._
  - `let`, `const` 키워드로 선언된 변수는 같은 스코프 내에서 중복 선언을 허용하지 않는다.
- 프로그래밍 언어에서는 스코프(유효 범위)를 통해 식별자인 변수 이름의 충돌을 방지하여 같은 이름의 변수를 사용할 수 있게 한다. 스코프 내에서 식별자는 유일해야 하지만 다른 스코프에서는 다른 이름의 식별자를 사용할 수 있다. (스코프 = 네임스페이스)

## 13.2 스코프의 종류

| 구분         | 설명                  | 스코프      | 변수      |
| ------------ | --------------------- | ----------- | --------- |
| 전역(global) | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역(local)  | 함수 몸체 내부        | 지역 스코프 | 지역 변수 |

### 전역 Global

- 코드의 가장 바깥 영역
- 전역에 변수를 선언하면 전역 스코프를 갖는 전역 변수가 됨
- 전역 변수는 어디서든지 참조할 수 있음

### 지역 Local

- 함수 몸체 내부
- 지역에 변수를 선언하면 지역 스코프를 갖는 지역 변수가 됨
- 자신의 지역 스코프와 하위 지역 스코프에서 유효

## 13.3 스코프 체인 Scope Chain

- 모든 스코프는 하나의 계층적 구조로 연결되어 있고, 모든 지역 스코프의 최상위 스코프는 전역 스코프다.
- 스코프 체인: 스코프가 계층적으로 연결된 것
- 자바스크립트 엔진은 변수를 참조할 때 스코프 체인을 통해 변수 참조가 있는 코드에서 상위 스코프 방향으로 이동하여 선언된 변수를 검색한다. (identifier resolution)
  - 하위 스코프에서 상위 스코프는 참조할 수 있지만, 상위 스코프에서 하위 스코프는 참조할 수 없다.
- 스코프 체인은 물리적인 실체로 존재한다.
  - 자바스크립트 엔진은 코드를 실행하기에 앞서 렉시컬 환경(자료구조)을 실제로 생성한다. 변수 선언이 실행되면 변수 식별자가 렉시컬 환경에 key로 등록되고, 변수 할당이 일어나면 렉시컬 환경의 변수 식별자에 해당하는 value를 변경한다. 변수의 검색도 이 자료구조 상에서 이루어진다.

## 13.4 함수 레벨 스코프 Function Level Scope

- 함수 레벨 스코프: 함수에 의해서 생성되는 지역 스코프
- 블록 레벨 스코프: `if`, `for`, `while`, `try/catch`, 함수 등 모든 코드 블록에서 생성되는 지역 스코프
- `var` 키워드로 선언된 변수는 오로지 함수 레벨 스코프만 지역 스코프로 인정한다.

```javascript
var x = 1;

if (true) {
  // if문은 함수 레벨 스코프가 아니므로 여기서 선언되는 x는 전역 변수다.
  // 원래 있던 전역 변수 x를 중복 선언하여 의도치 안헥 x의 값이 변경되어
  // x는 1에서 10이 된다....
  var x = 10;
}

console.log(x); // 10
```

```javascript
var i = 10;

// 마찬가지로 for문도 함수 레벨 스코프가 아니므로 i는 전역 변수다.
// i를 중복 선언하여 i의 값이 10에서 0, 1, 2, 3, 4.. 최종 5로 변경된다.
for (var i = 0; i < 5; i++) {
  console.log(i); // 0 1 2 3 4
}

console.log(i); // 5
```

> 어떻게 이런 무시무시한 언어가 있을 수 있지!?

## 13.5 렉시컬 스코프

```javascript
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}
```

`bar()`에서 호출되는 `x`는 `foo()`의 지역 변수인 `x`일까, 아니면 전역에 선언된 `x`일까?

1. 동적 스코프(dynamic scope): `foo()`에서 부를 때랑 전역에서 부를 때랑 `x` 값이 달라져!
2. 렉시컬 스코프(lexical scope) 또는 정적 스코프(static scope): 함수 호출 위치에 상관 없이 함수를 정의하는 시점에서 상위 스코프가 결정되어 `x`는 무조건 1이다!

- Javascript는 렉시컬 스코프를 따르므로 함수를 어디서 호출했는지가 아닌, 함수를 어디서 정의했는지에 따라 상위 스코프를 결정한다. 함수의 상위 스코프는 언제나 자신이 정의된 스코프다.
- 함수 정의(함수 선언문, 함수 표현식)가 실행되어 함수 객체가 생성되면, 함수 객체는 결정된 상위 스코프를 기억했다가 호출될 때 참조한다.
